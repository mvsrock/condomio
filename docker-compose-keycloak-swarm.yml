services:
  keycloak:
    image: quay.io/keycloak/keycloak:26.3.0
    environment:
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin
      KC_DB: postgres
      KC_DB_URL: jdbc:postgresql://postgres:5432/mimdb
      KC_DB_USERNAME: keycloak
      KC_DB_PASSWORD: password
      KC_DB_SCHEMA: mim
      KC_LOG_LEVEL: INFO
      KC_LOG_CONSOLE_OUTPUT: json
    command: ["start-dev","--http-port=8082","--features=preview"]
    ports:
      - target: 8082
        published: 8082
        mode: host
    networks:
      - keycloak-network
      - postgres-net
    depends_on:
      - postgres
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
      placement:
        constraints: [node.role == manager]
networks:
  keycloak-network:
  postgres-net:
    external:
      name: DB_postgres-net